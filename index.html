<!DOCTYPE html>
<html>
<head>
  <meta charset=utf-8 />
  <meta name="viewport" content="width=device-width"/>
  <title>Pixels</title>
  <link rel="stylesheet" type="text/css" href="css/master.css" />
</head>
<body >
<div id="items">
</div>
</body>
</html>

<script type="text/javascript" src="js/jquery-1.12.0.min.js"></script>
<script type="text/javascript">

$(document).ready(function () {

	/*FORMULA for counts below: 

		horizontalResolution / sqaurePixelSize
		verticalResolution / sqaurePixelSize

		eg: 
			1920 / 40 = 48
			1080 / 40 = 27

		This is not very precise, so size your 'pixels' so that there is no remainder after division to get a perfect fit...
	*/

	var countWidth = 48;
	var countHeight = 27;
	var count = countWidth * countHeight;

	//Echo the number of 'pixels' to console incase you need this value later
	console.log(count);

	//Loop of the resolution ('pixel' count) appending to the item div tag a smaller div tag with a blick image which represent the 'pixel'
	for (i=0; i < count; i++) {
    		var div = $('<div class="item" id='+ i +'><img src="img/black.jpg" width="40" height="40"/></div>');
    		div.html();
    		div.appendTo('#items');
	}
	reveal();
});

function reveal() {

	//Lets see if we need to continue or start a fresh reveal...
	if (checkCookie() == true) {
		//We parse the saved JSON cookie and then build a new regular JS array... *puke*
		var cookieData = JSON.parse(getCookie("ids")); 
		var ids = [];
		for (var i in cookieData) {
			ids.push(cookieData[i]);
			
		}
	} else {
		var ids = [];
	}

	var min = 1;
	var numPixels = $('.item').length;

	//Main reveal loop
        var pixelLoop = setInterval( function() {
		//Get the random and unique (and never duplicated) id number of each pixel id 
                var pixelId = Math.floor(Math.random() * ((numPixels-min)+1) + min);

		//if the pixel id does not exist in our id array, we enter it into the array and fade to zero opacity o nthat pixel div
                if (ids.indexOf(pixelId) == -1) {
                	ids.push(pixelId);
			setCookie('ids', ids, '1');
                        $('#' + pixelId).css('opcaity', 0).fadeTo(100, 0);
		//If we have reached tthe total number of pixels we stop the loop
                } else if (ids.length == numPixels) {
                	clearInterval(pixelLoop);
                       	//Used for dev and testing the regression of ids. Not for production!
                       	//checkDups();
                        return; 
                }	 

	},10);
}

function checkCookie() {

	var idArray = getCookie("ids");
    	if (idArray != "") {
        	alert(idArray);
		return true;
    	}else{
		alert('No Cookie!');
		return false;
    	}
}

function getCookie(cname) {
	var name = cname + "=";
    	var ca = document.cookie.split(',');
    	for(var i=0; i < ca.length; i++) {
        	var c = ca[i];
        	while (c.charAt(0)==' ') c = c.substring(1);
        		if (c.indexOf(name) == 0) return c.substring(name.length,c.length);
    	}
    	return "";
}

function setCookie(cname, cvalue, exdays) {

	var d = new Date();
    	d.setTime(d.getTime() + (exdays*24*60*60*1000));
    	var expires = "expires="+d.toUTCString();
    	document.cookie = cname + "=" + cvalue + "; " + expires;
}

//NOT FOR PRODUCTION!
function checkDups() {

	var sorted_ids = ids.slice().sort();
        var results = [];
		
	//Used this funciton during dev to verify that no duplicate pixels were duplicated in our reveal function.
        for (var i = 0; i < ids.length - 1; i++) {
        	if (sorted_ids[i + 1] == sorted_ids[i]) {
                	results.push(sorted_ids[i]);
                }
        }
        alert(results);
}
</script>
